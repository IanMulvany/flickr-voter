

<html>
<head>
    <link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
    <link type="text/css" rel="stylesheet" href="/stylesheets/activities.css" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>

<script type="text/javascript">
    (function($) { $(document).ready(function() {

 {% for activity in activities %}
        
            $('#{{ forloop.counter }}{{ activity.0.activity_id }}up').click(function() { 
                $.ajax({
                    type: 'POST', 
                    url: '/rpcincrement?actor={{ activity.0.author }}&activityid={{ activity.0.activity_id }}', 
                    dataType: 'json', 
                    success: function(json, textStatus) {
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}votetotals span[id="total"]').text(json.sum);
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}votetotals span[id="cast"]').text(json.count);
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}message').text("thanks for voting up");
                        }, 
                    error: function(xhr, textStatus, errorThrown) {
                        alert('An error occurred! '+ ( errorThrown ? errorThrown : xhr.status ) );
                        },
                     });
                });
                
            $('#{{ forloop.counter }}{{ activity.0.activity_id }}down').click(function() { 
                $.ajax({
                    type: 'POST', 
                    url: '/rpcdecrement?actor={{ activity.0.author }}&activityid={{ activity.0.activity_id }}', 
                    dataType: 'json', 
                    success: function(json, textStatus) {
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}votetotals span[id="total"]').text(json.sum);
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}votetotals span[id="cast"]').text(json.count);
                        $('#{{ forloop.counter }}{{ activity.0.activity_id }}message').text("thanks for voting down");
                        }, 
                    error: function(xhr, textStatus, errorThrown) {
                        alert('An error occurred! '+ ( errorThrown ? errorThrown : xhr.status ) );
                        },
                     });
                });
                
 {% endfor %}
              })})
        (jQuery);
</script>    

</head>
  <body>

    you want a list of all activities that we have looked at so far
    in total there are {{ count }} they are
    
      <p>
     {% if previous %}
      <a href="?newest=true">&lt;&lt;newest</a>              
      <a href="?previous={{ previous }}">&lt;newer</a>     
     {% endif %}
     {% if next %}
      <a href="?next={{ next }}">older&gt;</a>      
      <a href="?oldest=true">oldest&gt;&gt;</a>        
     {% endif %}
      </p>
        
    {% for activity in activities %}
        <div id="activityrecord">
        
             <p> 
                <a href="{{ activity.1 }}"><img src="{{ activity.2 }}"></a> 
             </p>
            
           {{ activity.0.author }} added a {{ activity.0.activity_type }} that said  {{ activity.0.activity_content }}
         
           <div id="{{ forloop.counter }}{{ activity.0.activity_id }}votetotals">
                vote total: <span id="total">{{ activity.0.vote_sum }}</span>,
                votes cast: <span id="cast">{{ activity.0.vote_count }}</span> 
           </div>

           <div id="voting">            
                <div id="{{ forloop.counter }}{{ activity.0.activity_id }}up">Vote Up</div>
                <div id="{{ forloop.counter }}{{ activity.0.activity_id }}down">Vote Down</div>
                <div id="{{ forloop.counter }}{{ activity.0.activity_id }}message">Waiting for a vote ...</div>
           </div>
           
            {% if admin %}
              activity creation time: {{ activity.0.created }}  
            {% endif %}
           
        </div>
    {% endfor %}
        


{% extends "admincontrols.html" %}
  </body>
</html>

